 clc,clear,close ('all')

jointpositions=[0.027376 -0.020160 0.027368
0.027376 -0.020160 0.063023
0.027376 -0.020160 0.094040
0.029000 -0.000986 0.081141
0.029000 -0.000986 0.119868
0.029000 -0.000986 0.144652
0.004441 0.002756 0.081429
0.004441 0.002755 0.127589
0.004441 0.002755 0.155771
-0.014869 0.001605 0.079331
-0.014869 0.001605 0.123084
-0.014869 0.001605 0.148079
-0.032603 -0.001084 0.072147
-0.032603 -0.001084 0.101826
-0.032603 -0.001084 0.122410
0.000000 0.000000 0.000000];

for i=1:15
    l(i)=norm(jointpositions(i,:)-jointpositions(i+1,:));
end

figure
hold on

jointmat=[1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 2.736750 2.016615 2.742055 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 6.302316 2.016617 2.742069 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 9.403941 2.016609 2.742058 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 8.114087 0.099173 2.904468 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 11.986777 0.099179 2.904466 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 14.465197 0.099168 2.904468 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 8.142869 -0.274968 0.448511 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 12.758831 -0.274962 0.448508 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 15.577104 -0.274958 0.448509 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 7.933078 -0.159889 -1.482461 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 12.308395 -0.159887 -1.482464 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 14.807828 -0.159883 -1.482458 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 7.214676 0.109017 -3.255912 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 10.182604 0.109010 -3.255911 1.000000
1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 12.240977 0.109013 -3.255910 1.000000
1.000000 -0.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 -0.000000 -0.000000 1.000000 0.000000 -0.000037 0.000584 0.004437 1.000000];


for i=1:9
    if i==1
        rotmat1=[jointmat(i,1) jointmat(i,2) jointmat(i,3) 0; jointmat(i,5) jointmat(i,6) jointmat(i,7) 0; jointmat(i,9) jointmat(i,10) jointmat(i,11) 0; jointpositions(i,1) jointpositions(i,2) jointpositions(i,3) jointmat(i,16)]'*trotx(-24*pi/180)*trotz(-75*pi/180)*troty(54*pi/180);%*trotx(-pi/4);
    elseif i==2
        rotmat1=rotmat1*transl(0,0,jointpositions(2,3)-jointpositions(1,3));
    elseif i==3
        rotmat1=rotmat1*transl(0,0,jointpositions(3,3)-jointpositions(2,3));
    else
        rotmat1=[jointmat(i,1) jointmat(i,2) jointmat(i,3) 0; jointmat(i,5) jointmat(i,6) jointmat(i,7) 0; jointmat(i,9) jointmat(i,10) jointmat(i,11) 0; jointpositions(i,1) jointpositions(i,2) jointpositions(i,3) jointmat(i,16)]';
    end
    
    if i==3 || i==6 || i==9 || i==12 || i==15 || i==16
        newrot1=rotmat1*transl(0.01,0,0);
        newrot2=rotmat1*transl(0,0.01,0);
        newrot3=rotmat1*transl(0,0,0.01);
    else
        newrot1=rotmat1*transl(0.01,0,0);
        newrot2=rotmat1*transl(0,0.01,0);
        newrot3=rotmat1*transl(0,0,l(i));
    end
    
    plot3([rotmat1(1,4) newrot1(1,4)],[rotmat1(2,4) newrot1(2,4)],[rotmat1(3,4) newrot1(3,4)],'k.-')
    plot3([rotmat1(1,4) newrot2(1,4)],[rotmat1(2,4) newrot2(2,4)],[rotmat1(3,4) newrot2(3,4)],'r.-')
    plot3([rotmat1(1,4) newrot3(1,4)],[rotmat1(2,4) newrot3(2,4)],[rotmat1(3,4) newrot3(3,4)],'b.-')
end

axis('equal')
